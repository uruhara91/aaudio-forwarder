name: Build AAudio Forwarder

on:
  push:
    branches: [ main, dev ]
  workflow_dispatch:

jobs:
  build-android:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
    
    - name: Setup Android NDK
      uses: nttld/setup-ndk@v1
      with:
        ndk-version: r26b
        add-to-path: true
    
    # Setup Gradle Global (Versi 8.2)
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2
      with:
        gradle-version: 8.2
    
    # --- PERUBAHAN UTAMA DI SINI ---
    # Kita hapus step 'chmod +x' karena kita gak pake gradlew local.
    
    - name: Build APK DEBUG (Direct Binary)
      # PENTING: Ganti './gradlew' jadi 'gradle'
      # Ini menggunakan gradle yang diinstall oleh action di atas, bukan script di repomu.
      run: gradle assembleDebug --stacktrace --no-daemon
    
    - name: List Output Files (Verification)
      if: always()
      run: |
        echo "=== CEK HASIL BUILD ==="
        find app/build/outputs/apk -name "*.apk" || echo "Masih kosong juga???"
    
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: aaudio-forwarder-debug
        path: app/build/outputs/apk/**/*.apk